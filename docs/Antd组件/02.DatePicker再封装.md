---
title: DatePicker再封装
date: 2021-08-14 15:47:41
permalink: /pages/4fead5/
categories:
  - 前端
tags:
  - 组件
---
由于Antd的RangeTime不好用，但又需要一个控件能实现RangeTime的功能。比如开始时间早于结束时间。基于Antd的DatePicker组件封装了一个类似RangeTime的时间选择器。


```
import { useEffect } from "react";
import { Col, Form } from "antd";
import { DatePicker } from "@/components/Antdd";
import moment from "moment";

const FormItem = Form.Item;

const RangeTime = (props) => {
  const range = (start, end) => {
    const result = [];
    for (let i = start; i < end; i++) {
      result.push(i);
    }
    return result;
  };

  // 限制开始日期
  const disabledStartDate = (current) => {
    const endTime = props.form.getFieldValue("end_time");
    // 小于2021年不能选
    if (current.year() < 2021) return true;
    // 大于结束时间年份不能选
    if (endTime && endTime.year() < current.year()) return true;
    // 小于结束时间月份 小于2021年7月不能选
    if (current.month() < 6 && current.year() === 2021) return true;
    if (endTime && endTime.year() > current.year()) return false;
    if (endTime && endTime.month() === current.month()) {
      return endTime.date() < current.date();
    } else if (endTime && endTime.month() > current.month()) {
      return null;
    } else if (endTime && endTime.month() < current.month()) {
      return true;
    }
  };

  //限制结束日期
  const disabledEndDate = (current) => {
    const startTime = props.form.getFieldValue("start_time");
    // 小于2021年不能选
    if (current.year() < 2021) return true;
    // 小于开始时间不能选
    if (startTime && startTime.year() > current.year()) return true;
    // 小于结束时间月份 小于2021年7月不能选
    if (current.month() < 6 && current.year() === 2021) return true;
    if (startTime && startTime.year() < current.year()) return false;
    if (startTime && startTime.month() === current.month()) {
      return startTime.date() > current.date();
    } else if (startTime && startTime.month() < current.month()) {
      return null;
    } else if (startTime && startTime.month() > current.month()) {
      return true;
    }
  };

  // 限制开始时间
  const disabledStartTime = (d) => {
    const endTime = props.form.getFieldValue("end_time");
    if (endTime) {
      if (d) {
        if (
          endTime.date() > d.date() ||
          endTime.month() > d.month() ||
          endTime.year() > d.year()
        ) {
          return {
            disabledHours: () => null,
          };
        } else {
          return {
            disabledHours: () => range(0, 24).splice(endTime.hours(), 24),
          };
        }
      }
      return {
        disabledHours: () => range(0, 24).splice(endTime.hours(), 24),
      };
    }
  };

  // 限制结束时间
  const disabledEndTime = (d) => {
    const startTime = props.form.getFieldValue("start_time");
    if (startTime) {
      if (d) {
        if (
          startTime.date() < d.date() ||
          startTime.month() < d.month() ||
          startTime.year() < d.year()
        ) {
          return {
            disabledHours: () => null,
          };
        } else {
          return {
            disabledHours: () => range(0, 24).splice(0, startTime.hours() + 1),
          };
        }
      }
      return {
        disabledHours: () => range(0, 24).splice(0, startTime.hours() + 1),
      };
    }
  };

  return (
    <>
      <Col span={6}>
        <FormItem
          name="start_time"
          style={{ margin: "0px" }}
          // rules={[{ required: !!props.form.getFieldValue('end_time'), message: "请选择开始时间" }]}
        >
          <DatePicker
            placeholder="开始时间"
            disabledDate={disabledStartDate}
            disabledTime={disabledStartTime}
            showTime={
              props.format
                ? false
                : {
                    minuteStep: 60,
                    defaultValue: moment("HH:00", "HH:mm"),
                  }
            }
            showNow={false}
            format={props.format || "YYYY-MM-DD HH:mm"}
            style={{ width: "100%" }}
          />
        </FormItem>
      </Col>
      <Col
        style={{
          width: "20px",
          height: "0px",
          borderTop: "1px solid #000",
          marginTop: "15px",
        }}
      ></Col>
      <Col span={6}>
        <FormItem
          name="end_time"
          style={{ margin: "0px" }}
          // rules={[{ required: !!props.form.getFieldValue('start_time'), message: "请选择结束时间" }]}
        >
          <DatePicker
            placeholder="结束时间"
            disabledDate={disabledEndDate}
            disabledTime={disabledEndTime}
            showTime={
              props.format
                ? false
                : {
                    minuteStep: 60,
                    defaultValue: moment("HH:00", "HH:mm"),
                  }
            }
            showNow={false}
            format={props.format || "YYYY-MM-DD HH:mm"}
            style={{ width: "100%" }}
          />
        </FormItem>
      </Col>
    </>
  );
};

export default RangeTime;
```
该组件实现的选择开始时间后，结束时间只能选择比开始时间晚。选择结束时间，开始时间只能选择比结束时间早。