(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{448:function(n,t,e){"use strict";e.r(t);var a=e(12),o=Object(a.a)({},(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("p",[n._v("æ ¹æ®å…¬å¸é¡¹ç›®éœ€è¦ï¼Œå°†è€é¡¹ç›®çš„è§†é¢‘ç›‘æ§åŠŸèƒ½ç§»æ¤åˆ°æ–°é¡¹ç›®ä¸­ï¼Œæ­£å¥½æœ‰æœºä¼šå®è·µä¸€ä¸‹qiankunæ¡†æ¶ã€‚æ ¹æ®"),e("a",{attrs:{href:"https://qiankun.umijs.org/zh",target:"_blank",rel:"noopener noreferrer"}},[n._v("å®˜ç½‘"),e("OutboundLink")],1),n._v("ä»‹ç»ï¼Œåº”ç”¨qiankunå¯¹æŠ€æœ¯æ ˆæ²¡æœ‰é™åˆ¶ï¼Œç”±äºqiankunçš„Apiéå¸¸ç®€æ´ï¼Œä¸»åº”ç”¨ä¸å­åº”ç”¨è¿›è¡Œç®€å•é…ç½®ï¼Œå°±èƒ½å®Œæˆæ”¹é€ ã€‚æœ€ååˆ†äº«ä¸€ä¸ªæ ¹æ®å®˜ç½‘æ­å»ºçš„qiankunå¾®åº”ç”¨ï¼Œå®ç°çˆ¶åº”ç”¨ä¸å­åº”ç”¨çš„ï¿½é€šä¿¡ï¼Œè‹¥æ˜¯qiankunå¯åŠ¨ï¼Œå…„å¼Ÿåº”ç”¨å¯ä»¥é€šè¿‡ä¿®æ”¹çˆ¶åº”ç”¨çš„å…¨å±€çŠ¶æ€æ¥é€šä¿¡ã€‚")]),n._v(" "),e("p",[n._v("é¡¹ç›®åœ°å€ï¼š"),e("a",{attrs:{href:"https://github.com/AlienGao/qiankun-demo",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://github.com/AlienGao/qiankun-demo"),e("OutboundLink")],1)]),n._v(" "),e("h2",{attrs:{id:"ä¸»åº”ç”¨é…ç½®"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»åº”ç”¨é…ç½®"}},[n._v("#")]),n._v(" ä¸»åº”ç”¨é…ç½®")]),n._v(" "),e("p",[e("em",[n._v("main/src/micro-apps.js")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("import shared from './shared'\n\nconst mircoApps = [\n  {\n    name: 'react-app',\n    entry: process.env.REACT_APP_REACT_PATH,\n    activeRule: '/app-react',\n  },\n  {\n    name: 'vue-app',\n    entry: process.env.REACT_APP_VUE_PATH,\n    activeRule: '/app-vue',\n  }\n]\n\n// console.log(process.env, 'vue_path')\n\nconst apps = mircoApps.map(app => {\n  return {\n    ...app,\n    // å­åº”ç”¨å®¹å™¨\n    container: '#container',\n    props: {\n      // æš´éœ²ç»™å­åº”ç”¨çš„æ–¹æ³•\n      getGlobalState: shared.getGlobalState,\n      setGlobalState: shared.setGlobalState\n    }\n  }\n})\n\nexport default apps\n")])])]),e("p",[e("em",[n._v("main/src/shared/index.js")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("import { initGlobalState } from 'qiankun';\n\nconst initialState = { taskList: [] };\n\nconst actions = initGlobalState(initialState);\n\nactions.onGlobalStateChange((newState, prev) => {\n  // state: å˜æ›´åçš„çŠ¶æ€; prev å˜æ›´å‰çš„çŠ¶æ€\n  console.log('main change', JSON.stringify(newState), JSON.stringify(prev));\n\n  for (let key in newState) {\n    initialState[key] = newState[key]\n  }\n}, true);\n\n// å®šä¹‰ä¸€ä¸ªè·å–stateçš„æ–¹æ³•ä¸‹å‘åˆ°å­åº”ç”¨\nactions.getGlobalState = (key) => {\n  // æœ‰keyï¼Œè¡¨ç¤ºå–globalStateä¸‹çš„æŸä¸ªå­çº§å¯¹è±¡\n  // æ— keyï¼Œè¡¨ç¤ºå–å…¨éƒ¨\n  return key ? initialState[key] : initialState\n}\n\n// actions.setGlobalState(state);\n\nexport default actions;\n")])])]),e("p",[n._v("è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸»è¦é…ç½®äº†å­åº”ç”¨çš„ç«¯å£ï¼Œå®¹å™¨å’Œéœ€è¦ç”¨åˆ°çš„æ–¹æ³•ï¼Œé€šè¿‡å°†setGloablStateæš´éœ²ç»™å­åº”ç”¨ï¼Œå¯ä»¥åšåˆ°é€šè¿‡ä¸€ä¸ªå­åº”ç”¨ä¿®æ”¹å…¨å±€çŠ¶æ€å†åŒæ­¥ç»™å¦ä¸€ä¸ªå­åº”ç”¨ã€‚")]),n._v(" "),e("p",[n._v("æœ€åï¼Œåœ¨çˆ¶åº”ç”¨çš„å…¥å£æ–‡ä»¶æ³¨å†Œå­åº”ç”¨ã€‚")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("import reportWebVitals from './reportWebVitals';\nimport { registerMicroApps, start, setDefaultMountApp } from 'qiankun';\nimport microApps from './micro-apps'\n\nconst apps = microApps\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\nregisterMicroApps(apps, {\n  beforeLoad: [app => {\n    console.log(`${app.name}-beforeLoad`)\n  }],\n  beforeMount: [app => {\n    console.log(`${app.name}-beforeMount`)\n  }],\n  afterMount: [app => {\n    console.log(`${app.name}-afterMount`)\n  }],\n  beforeUnmount: [app => {\n    console.log(`${app.name}-beforeUnmount`)\n  }],\n  afterUnmount: [app => {\n    console.log(`${app.name}-beforeUnmount`)\n  }]\n});\n\nsetDefaultMountApp('/app-vue')\n// å¯åŠ¨ qiankun\nstart();\n")])])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlienGao/image-store@main/blog/image.1b6hntpvy0m.png",alt:"æ•ˆæœå›¾"}}),n._v("\nä¸Šé¢ä¸ºæ•ˆæœå›¾ï¼Œä¸Šæ–¹ä¸ºä¸»åº”ç”¨ï¼Œä¸‹æ–¹ä½å¾®åº”ç”¨å®¹å™¨ã€‚")]),n._v(" "),e("h2",{attrs:{id:"å­åº”ç”¨é…ç½®"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å­åº”ç”¨é…ç½®"}},[n._v("#")]),n._v(" å­åº”ç”¨é…ç½®")]),n._v(" "),e("p",[n._v("å­åº”ç”¨é¦–å…ˆéœ€è¦åœ¨å…¥å£æ–‡ä»¶å¤„é…ç½®ä¸‰ä¸ªé’©å­å‡½æ•°ç”¨äºqiankunè¯†åˆ«ç”Ÿå‘½å‘¨æœŸã€‚")]),n._v(" "),e("p",[e("em",[n._v("vue-app/src/main.js")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("export async function bootstrap() {\n  console.log('[vue] vue app bootstraped');\n}\nexport async function mount(props) {\n  console.log('[vue] props from main framework', props);\n  globalRegister(store, props)\n  render(props);\n}\nexport async function unmount() {\n  instance.$destroy();\n  instance.$el.innerHTML = '';\n  instance = null;\n  router = null;\n}\n")])])]),e("p",[n._v("å…¶æ¬¡åœ¨Vueå­åº”ç”¨mountæ—¶æœŸï¼Œé€šè¿‡globalRegisterå‡½æ•°åˆå§‹åŒ–äº†å…¨å±€çŠ¶æ€ã€‚")]),n._v(" "),e("p",[e("em",[n._v("vue-app/src/shared/index.js")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("/**\n * \n * @param {vuexå®ä¾‹} store \n * @param {qiankunä¸‹å‘çš„props} props \n */\nfunction registerGlobalModule(store, props = {}) {\n  if (!store || !store.hasModule) {\n    return;\n  }\n\n  // è·å–åˆå§‹åŒ–çš„state\n  const initState = props.getGlobalState && props.getGlobalState() || {};\n  // å°†çˆ¶åº”ç”¨çš„æ•°æ®å­˜å‚¨åˆ°å­åº”ç”¨ä¸­ï¼Œå‘½åç©ºé—´å›ºå®šä¸ºglobal\n  if (!store.hasModule('global')) {\n    const globalModule = {\n      namespaced: true,\n      state: initState,\n      actions: {\n        // å­åº”ç”¨æ”¹å˜stateå¹¶é€šçŸ¥çˆ¶åº”ç”¨\n        setGlobalState({ commit }, payload) {\n          commit('setGlobalState', payload);\n          commit('emitGlobalState', payload);\n        },\n        // åˆå§‹åŒ–ï¼Œåªç”¨äºmountæ—¶åŒæ­¥çˆ¶åº”ç”¨çš„æ•°æ®\n        initGlobalState({ commit }, payload) {\n          commit('setGlobalState', payload);\n        },\n      },\n      mutations: {\n        setGlobalState(state, payload) {\n          // eslint-disable-next-line\n          state = Object.assign(state, payload);\n        },\n        // é€šçŸ¥çˆ¶åº”ç”¨\n        emitGlobalState(state) {\n          if (props.setGlobalState) {\n            // console.log(state, 'emitGlobalState')\n            props.setGlobalState(state);\n          }\n        },\n      },\n    };\n    store.registerModule('global', globalModule);\n  } else {\n    // æ¯æ¬¡mountæ—¶ï¼Œéƒ½åŒæ­¥ä¸€æ¬¡çˆ¶åº”ç”¨æ•°æ®\n    store.dispatch('global/initGlobalState', initState);\n  }\n}\n\nexport default registerGlobalModule;\n")])])]),e("p",[n._v("è‹¥Vueåº”ç”¨æ²¡æœ‰global Modalï¼Œåˆ™æ ¹æ®å…¨å±€çŠ¶æ€åˆ›å»ºä¸€ä¸ªã€‚å…¶ä¸­èƒ½å¤Ÿé€šè¿‡çˆ¶åº”ç”¨ä¼ é€’çš„setGlobalStateæ–¹æ³•æ”¹å˜çˆ¶åº”ç”¨çŠ¶æ€ã€‚")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("  computed: {\n    taskList() {\n      return this.$store.state.global.taskList;\n    }\n  },\nmethods: {\n    onChange(task) {\n      this.$store.dispatch('global/setGlobalState', task)\n      // this.microSetGlobalState(this.$store.state.global)\n        }\n  },\n")])])]),e("p",[n._v("Vueåº”ç”¨å¯ä»¥é€šè¿‡è®¡ç®—å±æ€§è·å–æœ€æ–°çš„çˆ¶åº”ç”¨çŠ¶æ€ã€‚å…¶ä¸­æœ‰ä¸¤ç§æ–¹å¼ä¿®æ”¹çˆ¶åº”ç”¨çŠ¶æ€ï¼Œä¸€ç§æ˜¯é€šè¿‡dispatch 'global/setGlobalState' actionï¼Œå¦ä¸€ç§æ˜¯ç›´æ¥é€šè¿‡çˆ¶åº”ç”¨ä¼ é€’çš„setGlobalStateæ–¹æ³•ä¿®æ”¹ï¼Œè¯¥æ–¹æ³•éœ€è¦åœ¨Vueçš„å…¥å£æ–‡ä»¶ä¸­è®¾ç½®Vueå®ä¾‹çš„å…¨å±€æ–¹æ³•ã€‚")]),n._v(" "),e("p",[e("em",[n._v("vue-app/src/main.js")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("  const { container, getGlobalState } = props;\n  Vue.prototype.getGlobalState = getGlobalState\n")])])]),e("p",[n._v("ç‚¹å‡»çˆ¶åº”ç”¨æ·»åŠ ä»»åŠ¡ï¼Œåœ¨Vueåº”ç”¨ä¸­è¿›è¡ŒåŒå‘ç»‘å®šã€‚\n"),e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlienGao/image-store@main/blog/image.6113sfc4p34.png",alt:"æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"}})]),n._v(" "),e("p",[n._v("åœ¨Vueå­åº”ç”¨ä¸­ä¿®æ”¹ä»»åŠ¡\n"),e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlienGao/image-store@main/blog/image.1jh5t7uspl40.png",alt:"æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"}})]),n._v(" "),e("p",[n._v("èƒ½å¤Ÿåœ¨å…„å¼Ÿåº”ç”¨ä¸­å±•ç¤ºæœ€æ–°çš„ä»»åŠ¡å†…å®¹\n"),e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/AlienGao/image-store@main/blog/image.1aablsy30qrk.png",alt:"æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"}})]),n._v(" "),e("p",[n._v("æœ€åæœªæ¥è®©ä¸»åº”ç”¨èƒ½æ­£ç¡®è¯†åˆ«å¾®åº”ç”¨æš´éœ²å‡ºæ¥çš„ä¸€äº›ä¿¡æ¯ï¼Œå¾®åº”ç”¨çš„æ‰“åŒ…å·¥å…·éœ€è¦å¢åŠ å¦‚ä¸‹é…ç½®ã€‚")]),n._v(" "),e("p",[e("em",[n._v("vue-app/vue.config.js")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("const { name } = require('./package');\nmodule.exports = {\n  devServer: {\n    // open: true,\n    // hot: true,\n    // compress: true,\n    // disableHostCheck: true,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n    },\n  },\n  configureWebpack: {\n    output: {\n      library: `${name}-[name]`,\n      libraryTarget: 'umd', // æŠŠå¾®åº”ç”¨æ‰“åŒ…æˆ umd åº“æ ¼å¼\n      jsonpFunction: `webpackJsonp_${name}`,\n    },\n  },\n};\n")])])]),e("p",[n._v("ğŸ‰å½©è›‹ğŸ‰ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­é…ç½®äº†npm-run-allçš„å‘½ä»¤ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯åŠ¨ä¸»åº”ç”¨ä¸å­åº”ç”¨ã€‚")])])}),[],!1,null,null,null);t.default=o.exports}}]);