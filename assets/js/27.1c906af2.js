(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{460:function(n,s,a){"use strict";a.r(s);var e=a(12),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h1",{attrs:{id:"单图片下载与多图片打包下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单图片下载与多图片打包下载"}},[n._v("#")]),n._v(" 单图片下载与多图片打包下载")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("  import JSZip from 'jszip'\n  import FileSaver from 'file-saver'\n\n  // 判断单张图片还是多张图片\n  const downloadImg = list => {\n    if (Array.isArray(list)) {\n      handleBatchDownload(list)\n    } else {\n      imageDownload(list)\n    }\n  }\n  \n  // 单个文件下载\n  const imageDownload = src => {\n    let canvas = document.createElement('canvas')\n    let img = document.createElement('img')\n    img.onload = () => {\n      canvas.width = img.width\n      canvas.height = img.height\n      let context = canvas.getContext('2d')\n      context.drawImage(img, 0, 0, img.width, img.height)\n      canvas.getContext('2d').drawImage(img, 0, 0, img.width, img.height)\n      canvas.toBlob(blob => {\n        let link = document.createElement('a')\n        link.href = window.URL.createObjectURL(blob)\n        link.download = '抓拍'\n        link.click()\n      }, \"image/jpeg\", \"1\")\n      setModalLoading(false)\n    }\n    img.setAttribute(\"crossOrigin\", 'Anonymous')\n    img.src = src\n  }\n\n  const getFile = (url) => {\n    return new Promise((resolve, reject) => {\n      axios({\n        method: 'get',\n        url,\n        responseType: 'arraybuffer',\n        headers: {\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Content-Disposition\": \"attachment\"\n        },\n      }).then(data => {\n        resolve(data.data)\n      }).catch(error => {\n        reject(error.toString())\n      })\n    })\n  };\n  \n  // 批量下载引入了两个包，JSZip用于创建打包文件，FileSaver用于下载\n  const handleBatchDownload = async(selectImgList) => {\n    const data = selectImgList;\n    const zip = new JSZip()\n    const cache = {}\n    const promises = []\n    setModalLoading(true)\n    await data.forEach((item, index) => {\n        const promise = getFile(item).then(data => { // 下载文件, 并存成ArrayBuffer对象\n        let file_name = `抓拍(${index+1}).jpg` // 获取文件名\n        zip.file(file_name, data, {\n          binary: true\n        }) // 逐个添加文件\n        cache[file_name] = data\n      })\n      promises.push(promise)\n    })\n    Promise.all(promises).then(() => {\n      zip.generateAsync({\n        type: \"blob\"\n      }).then(content => { // 生成二进制流\n        FileSaver.saveAs(content, \"抓怕.zip\") // 利用file-saver保存文件\n      })\n    })\n  };\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);